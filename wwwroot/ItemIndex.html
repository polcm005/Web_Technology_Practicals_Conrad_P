<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
</head>
<body>
    <div class="container">
        <h1 class="alert alert-info text-center">
            Items
        </h1>
    </div>
    <div class="container">
        <div class="row mb-3">
            <div class="col-7">
                <input class="form-control" id="APISearchText" placeholder="Enter search query..." />
            </div>
            <div class="col-4">
                <select class="form-control" id="APICategorySelect">
                    <option value="">Select Categories...</option>
                </select>
            </div>
            <div class="col">
                <button type="button" class="btn btn-outline-primary" id="SearchButtonID">Search</button>
            </div>
        </div>
        <div class="row justify-content-between" id="rowElement">
            <div class="col-4" hidden id="columnReference">
                <div class="card mb-3">
                    <div class="card-body">
                        <h5 class="card-title"></h5>
                        <p class="card-text" id="paragraph1"></p>
                        <p class="card-text" id="paragraph2"></p>
                    </div>
                    <img src="" class="card-img-top" />
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <script>

        var selectReference = document.querySelector('#APICategorySelect');
        function populateSelect() { 
            console.log(selectReference);
            fetch('api/ParentCategoriesWebAPI')
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    for (let x = 0; x < data.length; x++) {
                        let newSelection = document.createElement("option")
                        newSelection.innerText = data[x].categoryName;
                        newSelection.value = data[x].categoryId;
                        selectReference.appendChild(newSelection)
                    }
                });
        }
        populateSelect();

        var rowReference = document.querySelector("#rowElement");

        function buildItems(data) {
        for (let i = 0; i < 10; i++) {
            let column = rowReference.querySelector("#columnReference").cloneNode(true);
            column.hidden = false;
            rowReference.appendChild(column)
            //column.querySelector("H5").innerText = "New Card Title";
            column.querySelector("H5").innerText = data[i].itemName;
            column.querySelector("#paragraph1").innerText = data[i].itemDescription;
            column.querySelector("#paragraph2").innerText = "$" + data[i].itemCost;
            let image = column.querySelector("img");
            image.setAttribute("src", data[i].itemImage);
            image.setAttribute("alt", "No image");            
            };
        };
        //fetch("api/ItemsWebAPI")
        //    .then(response => response.json())
        //    .then(data => {
        //        console.log(data);
        //        buildItems(data)
        //    })

        
        function buildSearchItems(data) {
            removedColumns = rowReference.querySelectorAll('#columnReference:not([Hidden])')
            removedColumns.forEach(j => { rowReference.removeChild(j) });
            for (let i = 0; i < data.length; i++) {
                let column = rowReference.querySelector("#columnReference").cloneNode(true);
                column.hidden = false;
                rowReference.appendChild(column)
                column.querySelector("H5").innerText = data[i].itemName;
                column.querySelector("#paragraph1").innerText = data[i].itemDescription;
                column.querySelector("#paragraph2").innerText = "$" + data[i].itemCost;
                let image = column.querySelector("img");
                image.setAttribute("src", data[i].itemImage);
                image.setAttribute("alt", "No image");
                
            }
        }
        console.log(selectReference.value)
        let SearchButton = document.querySelector('#SearchButtonID')
        SearchButton.addEventListener("click", (e) => {
            let textToSearch = document.querySelector('#APISearchText').value;
            fetch(`api/ItemsWebAPI?SearchText=${textToSearch}&CategoryID=${selectReference.value}`)
                .then(response => response.json())
                .then(data => buildSearchItems(data))
                });
        
    </script>
</body>
</html>
